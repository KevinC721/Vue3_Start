<template>
  <h1>Reactive</h1>
  <i>ä½œç”¨ï¼šå®šä¹‰ä¸€ä¸ªå¯¹è±¡ç±»å‹çš„å“åº”å¼æ•°æ®ï¼ˆåŸºæœ¬ç±»å‹ä¸è¦ç”¨å®ƒï¼Œè¦ç”¨ ref å‡½æ•°ï¼‰</i><br>
  <i>reactive æ¥å—ä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–æ•°ç»„ï¼‰ï¼Œè¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆProxy çš„å®ä¾‹å¯¹è±¡ï¼Œç®€ç§° proxy å¯¹è±¡ï¼‰</i><br>
  <i>å†…éƒ¨åŸºäº ES6 çš„ Proxy å®ç°ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡æ“ä½œæºå¯¹è±¡å†…éƒ¨æ•°æ®è¿›è¡Œæ“ä½œ</i>
  <hr>

  <h3>å§“åï¼š{{ person.name }}</h3>
  <h3 v-show="person.sex">æ€§åˆ«ï¼š{{ person.sex }}</h3>
  <h3>å·¥ä½œï¼š{{ person.job.type }}</h3>
  <h3>è–ªèµ„ï¼š{{ person.job.salary }}</h3>
  <h3>çˆ±å¥½ï¼š{{ person.hobby }}</h3>
  <button @click="change">ğŸ”˜ æŒ‰é’®</button>
  <button @click="addProp">ğŸ”˜ æ·»åŠ ä¸€ä¸ªå±æ€§</button>
  <button @click="deleteProp">ğŸ”˜ åˆ é™¤ä¸€ä¸ªå±æ€§</button>
  <hr>
  
  <h1>Vue2 ä¸ Vue3 å“åº”å¼åŸç†å¯¹æ¯”</h1>
  <h2>Vue2</h2>
  <h3>å®ç°åŸç†</h3>
  <ol>
    <li>å¯¹è±¡ç±»å‹ï¼šé€šè¿‡ object.defineProperty()å¯¹å±æ€§çš„è¯»å–ã€ä¿®æ”¹è¿›è¡Œæ‹¦æˆªï¼ˆæ•°æ®åŠ«æŒï¼‰</li>
    <li>
      æ•°ç»„ç±»å‹ï¼šé€šè¿‡é‡å†™æ›´æ–°æ•°ç»„çš„ä¸€ç³»åˆ—æ–¹æ³•æ¥å®ç°æ‹¦æˆªã€‚ï¼ˆå¯¹æ•°ç»„çš„å˜æ›´æ–¹æ³•è¿›è¡Œäº†åŒ…è£¹ï¼‰<br>
      <code>
        Object.defineProperty(data, 'count', {
          get() {},
          set() {}
        })
      </code>
    </li>
  </ol>
  <h3>å­˜åœ¨é—®é¢˜</h3>
  <ol>
    <li>æ–°å¢<b class="hight-red">å±æ€§ã€åˆ é™¤</b>å±æ€§ï¼Œç•Œé¢ä¸ä¼šæ›´æ–°</li>
    <li>ç›´æ¥é€šè¿‡<b class="hight-red">ä¸‹æ ‡ä¿®æ”¹</b>æ•°ç»„ï¼Œç•Œé¢ä¸ä¼šè‡ªåŠ¨æ›´æ–°</li>
  </ol>
  <h2>Vue3</h2>
  <h3>å®ç°åŸç†</h3>
  <ol>
    <li>é€šè¿‡ Proxyï¼ˆä»£ç†ï¼‰ï¼šæ‹¦æˆªå¯¹è±¡ä¸­ä»»æ„å±æ€§çš„å˜åŒ–ï¼ŒåŒ…æ‹¬ï¼šå±æ€§å€¼çš„è¯»å†™ã€å±æ€§çš„æ·»åŠ ã€å±æ€§çš„åˆ é™¤ç­‰</li>
    <li>é€šè¿‡ Reflectï¼ˆåå°„ï¼‰ï¼šå¯¹è¢«ä»£ç†å¯¹è±¡çš„å±æ€§è¿›è¡Œæ“ä½œã€‚ç›¸æ¯”è¾ƒ Objectï¼ŒReflect æ›´åŠ å‹å¥½ï¼Œå¯ä»¥æ˜¯å¼€å‘è€…æ›´çµæ´»çš„é€šè¿‡æ“ä½œè¿”å›çš„ç»“æœè¿›è¡Œåç»­é€»è¾‘ç¼–å†™ä¸å¼‚å¸¸å¤„ç†</li>
    <li>
      <code>
        new Proxy(data, {<br>
          // æ‹¦æˆªè¯»å–å±æ€§å€¼<br>
          get(target, prop) {<br>
            return Reflect.get(target, prop)<br>
          },<br>
          // æ‹¦æˆªè®¾ç½®å±æ€§å€¼æˆ–æ·»åŠ æ–°å±æ€§
          set(target, prop, value) {<br>
            return Reflect.set(target, prop, value)<br>
          },<br>
          // æ‹¦æˆªåˆ é™¤å±æ€§
          deleteProperty(target, prop) {<br>
            return Reflect.deleteProperty(target, prop)
          }<br>
        })<br>
        <br>
        proxy.name = 'tom'
      </code>
    </li>
  </ol>
</template>

<script>
import { reactive } from 'vue'

export default {
  setup() {
    // reactive å®šä¹‰çš„å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ª proxy å®šä¹‰çš„å¯¹è±¡
    let person = reactive({
      name: 'å¼ ä¸‰',
      job: {
        type: 'å‰ç«¯',
        salary: '30K'
      },
      hobby: ['ç¯®çƒ', 'æ—…è¡Œ']
    })

    // Vue3 å“åº”å¼å®ç°åŸç†
    // const p = new Proxy(person)
    // console.log(p);

    function change() {
      person.job.type = 'åç«¯'
      person.job.salary = '40K'
      person.hobby[2] = 'æ¸¸æˆ'
      console.log('ğŸ¾ğŸ¾ğŸ¾', person);
    }

    function addProp() {
      person.sex = 'male'
    }
    function deleteProp() {
      delete person.sex
    }

    return {
      person,
      change,
      addProp,
      deleteProp
    }
  }
}
</script>

<style scoped>
.hight-red {
  color: red;
}
</style>